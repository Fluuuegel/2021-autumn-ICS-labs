# ICS Lab4 实验报告

> 张艺耀 PB2011630

## Task1

```bash
1110 010 000001110	;LEA R2 14; R2 = x300F 
0101 000 000 1 00000	;R0 = 0
0100 1 0000000000x	;JSR PCoffsetx; x = 1
1111000000100101	;halt
0111 111 010 000000	;STR R7 R2 0;
0001 010 010 1 0x001	;R2 = R2 + x001	;x = 0
0001 000 000 1 00001	;R0 = R0 + 1
0010 001 000010001	;LD R1 PC + 1 + 10001; R1 = 5
0001 001 x01 111111	;R1 = Rx01 -1	;R1 = R1 - 1; x = 0
0011 001 000001111	;ST R1 PC + 1 + F	;每次循环26处值-1
0000 010 000000001	;if(R1 = 0) to PC + 1 + 1
0100 1 11111111000	;JSR PC + 1 - 8
0001 010 010 1 11111	;R2 = R2 - 1
01x0 111 010 000000	;LDR R7 R2 0	; x = 1
1100 000 111 000000	;RET to R7
0000000000000000	; -> x3003
0000000000000000	;R2(1)
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000101	;5 -> 4
```

```bash
R0 = 5, R1 = 0, R2 = 300f, R3 = 0
R4 = 0, R5 = 0, R6 = 0, R7 = 3003
```

代码逻辑如上，x的值分别为1 0 0 1。

## Task2

```bash
0010 001 000010101	;LD R1 PC + 1 + 21; R1 = x0120
0100 1 00000001000	;JSR PC + 1 + 8; R7 = x3002
0101 010 001 1 00111	;R2 = R1 AND 00111
0001 001 010 0 00 100	;R1 = R2 + R4
0001 000 0xx x 11001	;R0 = R1 - 7; xxx = 011
0000 001 1xxx11011	;if(R0 > 0) to 2行;若R1 - 7仍>0 执行大循环 xxx=111
0001 000 0xx x 11001	;R0 = R1 - 7; xxx = 011
0000 100 000000001	;if(R0 < 0) to 10行
0001 001 001 1 11001	;R1 = R1 - 7;若最后R1 = 7，那么余数是0，R1应减去7
1111 0000 00100101	;halt
0101 010 010 1 00000	;R2 = 0
0101 011 011 1 00000	;R3 = 0
0101 100 100 1 00000	;R4 = 0
0001 010 010 1 00001	;R2 = 1
0001 011 011 1 01000	;R3 = 8
0101 101 011 0 00 001	;R5 = R1 AND R3
0000 010 000000001	;if(R5 = 0) to 19行
0001 100 010 0 00 100	;R4 = R2 + R4
0001 010 010 0 00 010	;R2 = R2 + R2
0001 xxx 011 0 00 011	;R3 = R3 + R3; xxx = 011
0000 xxx 111111010	;if(R3 != 0) to 16行; xxx = 101
1100 000 111 000000	;to R7
0000 0001 0010 0000
```

不难推断基本思路如下：

设R1中的数为x ，设${x = 8u + v (0\le v < 8)}$ 那么有：${x \equiv 8u + v \equiv 7u + u + v \equiv u + v (mod 7)}$

不断重操作即可得到模7的余数。

代码的第1至9行为判断callee返回结果是否在`0<= R1 < 7`的范围内；第11至22行把R1右移3位（对应十进制除以8取整）存到R4。

(代码逻辑详见注释)

则xxx xxx xxx xxx xxx分别为011 111 011 011 101。